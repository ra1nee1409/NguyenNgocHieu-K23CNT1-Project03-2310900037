<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
</head>

<body>
    <div th:replace="~{admin/fragments/admin-layout :: layout(~{::title}, ~{::content})}">
        <title th:text="${banner.id != null} ? 'Chỉnh sửa Banner' : 'Thêm Banner'">Banner Form</title>

        <div th:fragment="content">
            <!-- Header -->
            <div class="content-header">
                <h1 th:text="${banner.id != null} ? 'Chỉnh sửa Banner' : 'Thêm Banner Mới'">Banner Form</h1>
                <a href="/admin/banners" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Quay lại
                </a>
            </div>

            <!-- Content Body -->
            <div class="content-body">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-body">
                                <form
                                    th:action="${banner.id != null} ? @{/admin/banners/update/{id}(id=${banner.id})} : @{/admin/banners}"
                                    method="post" enctype="multipart/form-data">

                                    <!-- Tên Slide -->
                                    <div class="mb-3">
                                        <label for="name" class="form-label">
                                            Tên Slide <span class="text-danger">*</span>
                                        </label>
                                        <input type="text" class="form-control" id="name" name="name"
                                            th:value="${banner.name}" required placeholder="Nhập tên slide">
                                    </div>

                                    <!-- Hình ảnh Banner -->
                                    <div class="mb-3">
                                        <label for="imageFile" class="form-label">
                                            Hình ảnh Banner <span th:if="${banner.id == null}"
                                                class="text-danger">*</span>
                                        </label>
                                        <input type="file" class="form-control" id="imageFile" name="imageFile"
                                            accept="image/*" th:required="${banner.id == null}"
                                            onchange="previewImage(event)">
                                        <div class="form-text">Kích thước đề xuất: 1920x600px</div>

                                        <!-- Preview NEW image -->
                                        <div id="imagePreview" class="mt-3" style="display: none;">
                                            <label class="form-label">Ảnh mới:</label>
                                            <div>
                                                <img id="preview" src="#" alt="Preview"
                                                    style="max-width: 100%; height: auto; border-radius: 8px; border: 1px solid #dee2e6;">
                                            </div>
                                        </div>

                                        <!-- Preview current image -->
                                        <div th:if="${banner.imageUrl != null}" class="mt-3" id="currentImage">
                                            <label class="form-label">Ảnh hiện tại:</label>
                                            <div>
                                                <img th:src="${banner.imageUrl}" alt="Current banner"
                                                    style="max-width: 100%; height: auto; border-radius: 8px; border: 1px solid #dee2e6;">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Thứ tự hiển thị -->
                                    <div class="mb-3">
                                        <label for="displayOrder" class="form-label">
                                            Thứ tự hiển thị
                                        </label>
                                        <input type="number" class="form-control" id="displayOrder" name="displayOrder"
                                            th:value="${banner.displayOrder}" value="0" min="0">
                                        <div class="form-text">Số nhỏ hơn sẽ hiển thị trước</div>
                                    </div>

                                    <!-- Kích hoạt -->
                                    <div class="mb-4">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="isActive"
                                                name="isActive" th:checked="${banner.isActive}">
                                            <label class="form-check-label" for="isActive">
                                                Kích hoạt <span class="text-muted">(hiển thị trên trang chủ)</span>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- Buttons -->
                                    <div class="d-flex gap-2">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="bi bi-check-circle"></i>
                                            <span th:text="${banner.id != null} ? 'Cập nhật' : 'Tạo mới'">Lưu</span>
                                        </button>
                                        <a href="/admin/banners" class="btn btn-outline-secondary">
                                            <i class="bi bi-x-circle"></i> Hủy
                                        </a>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <script>
                function previewImage(event) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            document.getElementById('preview').src = e.target.result;
                            document.getElementById('imagePreview').style.display = 'block';
                            
                            // Hide current image when new image is selected
                            const currentImage = document.getElementById('currentImage');
                            if (currentImage) {
                                currentImage.style.display = 'none';
                            }
                        }
                        reader.readAsDataURL(file);
                    }
                }
            </script>
        </div>
    </div>
</body>

</html>