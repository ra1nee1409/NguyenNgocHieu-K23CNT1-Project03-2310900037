<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{admin/fragments/admin-layout :: head}"></head>
<body class="bg-gray-50">
    <!-- Sidebar -->
    <div th:replace="~{admin/fragments/admin-layout :: sidebar}"></div>

    <!-- Main Content -->
    <div class="ml-64">
        <!-- Navbar -->
        <nav th:replace="~{admin/fragments/admin-layout :: navbar}"></nav>

        <!-- Content -->
        <main class="p-6">
            <!-- Breadcrumb -->
            <div class="flex items-center text-sm text-gray-500 mb-6">
                <a href="/admin/orders" class="hover:text-primary-600">Đơn hàng</a>
                <i class="fas fa-chevron-right mx-2 text-xs"></i>
                <span class="text-gray-900">Chi tiết đơn hàng #<span th:text="${order.id}"></span></span>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Main Order Info (Left Column) -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Products -->
                    <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                        <div class="p-6 border-b border-gray-100">
                            <h3 class="text-lg font-bold text-gray-800">Sản phẩm</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="bg-gray-50 text-gray-500 text-xs uppercase">
                                    <tr>
                                        <th class="px-6 py-3">Sản phẩm</th>
                                        <th class="px-6 py-3 text-center">Đơn giá</th>
                                        <th class="px-6 py-3 text-center">SL</th>
                                        <th class="px-6 py-3 text-right">Tổng</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-100">
                                    <tr th:each="item : ${orderItems}">
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-3">
                                                <img th:if="${item.nnhProduct.imageUrl != null}" 
                                                     th:src="${item.nnhProduct.imageUrl}" 
                                                     class="w-12 h-12 rounded object-cover border bg-gray-50">
                                                <div th:unless="${item.nnhProduct.imageUrl != null}" 
                                                     class="w-12 h-12 rounded bg-gray-100 flex items-center justify-center text-gray-400">
                                                    <i class="fas fa-image"></i>
                                                </div>
                                                <div>
                                                    <div class="font-medium text-gray-900" th:text="${item.nnhProduct.name}"></div>
                                                    <div class="text-xs text-gray-500">Mã: #<span th:text="${item.nnhProduct.id}"></span></div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 text-center text-gray-600">
                                            <span th:text="${#numbers.formatDecimal(item.unitPrice, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></span>
                                        </td>
                                        <td class="px-6 py-4 text-center text-gray-900 font-medium">
                                            x<span th:text="${item.quantity}"></span>
                                        </td>
                                        <td class="px-6 py-4 text-right font-bold text-gray-800">
                                            <span th:text="${#numbers.formatDecimal(item.unitPrice * item.quantity, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></span>
                                        </td>
                                    </tr>
                                </tbody>
                                <tfoot class="bg-gray-50">
                                    <tr>
                                        <td colspan="3" class="px-6 py-4 text-right font-bold text-gray-600">Tổng cộng:</td>
                                        <td class="px-6 py-4 text-right text-xl font-bold text-blue-600">
                                            <span th:text="${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></span>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>

                    <!-- Payment & Shipping Info -->
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Thông tin thanh toán & Vận chuyển</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <p class="text-sm text-gray-500 mb-1">Phương thức thanh toán</p>
                                <p class="font-medium text-gray-900 flex items-center gap-2">
                                    <i class="fas fa-money-bill-wave text-green-500"></i> Thanh toán khi nhận hàng (COD)
                                </p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 mb-1">Trạng thái thanh toán</p>
                                <span th:if="${order.status.name() == 'COMPLETED'}" class="text-green-600 font-bold">
                                    <i class="fas fa-check-circle mr-1"></i> Đã thanh toán
                                </span>
                                <span th:unless="${order.status.name() == 'COMPLETED'}" class="text-yellow-600 font-bold">
                                    <i class="fas fa-clock mr-1"></i> Chưa thanh toán
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar Info (Right Column) -->
                <div class="space-y-6">
                    <!-- Status Update Card -->
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Trạng thái đơn hàng</h3>
                        
                        <div class="mb-4">
                            <div th:if="${order.status != null}" th:switch="${order.status.name()}">
                                <div th:case="'PENDING'" class="text-center p-3 rounded-lg bg-yellow-50 text-yellow-800 font-bold border border-yellow-200">Chờ xác nhận</div>
                                <div th:case="'CONFIRMED'" class="text-center p-3 rounded-lg bg-blue-50 text-blue-800 font-bold border border-blue-200">Đã xác nhận</div>
                                <div th:case="'SHIPPING'" class="text-center p-3 rounded-lg bg-purple-50 text-purple-800 font-bold border border-purple-200">Đang giao hàng</div>
                                <div th:case="'DELIVERED'" class="text-center p-3 rounded-lg bg-green-50 text-green-800 font-bold border border-green-200">Đã giao hàng</div>
                                <div th:case="'COMPLETED'" class="text-center p-3 rounded-lg bg-green-100 text-green-900 font-bold border border-green-300">Hoàn thành</div>
                                <div th:case="*" class="text-center p-3 rounded-lg bg-red-50 text-red-800 font-bold border border-red-200">Đã hủy</div>
                            </div>
                        </div>

                        <form th:action="@{/admin/orders/{id}/status(id=${order.id})}" method="post">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Cập nhật trạng thái</label>
                            <select name="status" class="w-full border-gray-300 rounded-lg shadow-sm focus:border-primary-500 focus:ring-primary-500 mb-4 p-2 border">
                                <option th:each="status : ${statuses}" 
                                        th:value="${status}" 
                                        th:text="${status}" 
                                        th:selected="${status == order.status}"></option>
                            </select>
                            <button type="submit" class="w-full py-2 px-4 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg transition-colors shadow">
                                Cập nhật thay đổi
                            </button>
                        </form>
                    </div>

                    <!-- Customer Info Card -->
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Thông tin khách hàng</h3>
                        <div class="flex items-center gap-3 mb-4 pb-4 border-b border-gray-100">
                            <div class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center text-gray-500 text-xl">
                                <i class="fas fa-user"></i>
                            </div>
                            <div>
                                <p class="font-bold text-gray-900" th:text="${order.customerName}">Customer Name</p>
                                <p class="text-sm text-gray-500">Khách hàng</p>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <div>
                                <p class="text-xs text-gray-500 uppercase">Liên hệ</p>
                                <p class="text-gray-900 flex items-center gap-2">
                                    <i class="fas fa-phone text-gray-400 w-4"></i>
                                    <span th:text="${order.customerPhone}"></span>
                                </p>
                                <p class="text-gray-900 flex items-center gap-2 mt-1">
                                    <i class="fas fa-envelope text-gray-400 w-4"></i>
                                    <span th:text="${order.nnhUser.email}"></span>
                                </p>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 uppercase">Địa chỉ giao hàng</p>
                                <p class="text-gray-900 flex items-start gap-2">
                                    <i class="fas fa-map-marker-alt text-gray-400 w-4 mt-1"></i>
                                    <span th:text="${order.customerAddress}"></span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</body>
</html>
